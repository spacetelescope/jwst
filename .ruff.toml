extend = "pyproject.toml"

exclude = [
    "jwst/extern",
    "docs",
    ".tox",
    ".eggs",
    "build",
    "*.ipynb",
    "**/tests/test_*.py",
    "**/regtest/test_*.py",
]
line-length = 100

target-version = "py311"

[format]
quote-style = "double"
indent-style = "space"
docstring-code-format = true
exclude = [
    "jwst/coron/**.py",
    "jwst/cube_skymatch/**.py",
    "jwst/dark_current/**.py",
    "jwst/flatfield/**.py",
    "jwst/fringe/**.py",
    "jwst/ipc/**.py",
    "jwst/mrs_imatch/**.py",
    "jwst/persistence/**.py",
    "jwst/photom/**.py",
]

[lint]
select = [
    "F",      # Pyflakes (part of default flake8)
    "E",      # pycodestyle (part of default flake8)
    "W",      # pycodestyle (part of default flake8)
    "D",      # docstrings, see also numpydoc pre-commit action
    "N",      # pep8-naming (naming conventions)
    "A",      # flake8-builtins (prevent shadowing of builtins)
    "ARG",    # flake8-unused-arguments (prevent unused arguments)
    "B",      # flake8-bugbear (miscellaneous best practices to avoid bugs)
    "C4",     # flake8-comprehensions (best practices for comprehensions)
    "ICN",    # flake8-import-conventions (enforce import conventions)
    "INP",    # flake8-no-pep420 (prevent use of PEP420, i.e. implicit name spaces)
    "ISC",    # flake8-implicit-str-concat (conventions for concatenating long strings)
    "LOG",    # flake8-logging
    "NPY",    # numpy-specific rules
    "PGH",    # pygrep-hooks (ensure appropriate usage of noqa and type-ignore)
    "PTH",    # flake8-use-pathlib (enforce using Pathlib instead of os)
    "S",      # flake8-bandit (security checks)
    "SLF",    # flake8-self (prevent using private class members outside class)
    "SLOT",   # flake8-slots (require __slots__ for immutable classes)
    "T20",    # flake8-print (prevent print statements in code)
    "TRY",    # tryceratops (best practices for try/except blocks)
    "UP",     # pyupgrade (simplified syntax allowed by newer Python versions)
    "YTT",    # flake8-2020 (prevent some specific gotchas from sys.version)
]
ignore = [
    "D100", # missing docstring in public module
    "D105", # missing docstring in magic method
    "E741", # ambiguous variable name (O/0, l/I, etc.)
    "UP008", # use super() instead of super(class, self). no harm being explicit
    "UP015", # unnecessary open(file, "r"). no harm being explicit
    "UP038", # use | instead of tuple in isinstance check
    "TRY003", # prevents custom exception messages not defined in exception itself.
    "TRY400", # enforces log.exception instead of log.error in except clause.
    "ISC001", # single line implicit string concatenation. formatter recommends ignoring this.
]

[lint.pydocstyle]
convention = "numpy"

[lint.flake8-annotations]
ignore-fully-untyped = true  # Turn off annotation checking for fully untyped code

[lint.per-file-ignores]
"jwst/**/__init__.py" = [
    "E402", # module-level import not at top of file
    "F401", # unused import
    "F403", # import with *
    "F405", # ambiguous import from *
]
"**/tests/**.py" = [
    "D104", # missing docstring in public package
    "S101", # use of assert
]
"jwst/conftest.py" = [
    "SLF", "ARG", "PTH",
    "B003", # Assigning to os.environ does not clear the environment
]
"**/regtest/**.py" = [ # conftest, regtestdata, and sdp_pools_source
    "SLF", "ARG", "PTH",
    "A002", # builtin variable shadowing
    "S101", # use of assert
]
"jwst/associations/lib/*" = [
    "N801", # Use CapWords class naming convention
]
"jwst/associations/tests*" = [
    "F841", # unused variable
]
"jwst/lib/catalog_utils.py" = [
    "PTH100", # `os.path.abspath()` should be replaced by `Path.resolve()`
    "PTH111", # `os.path.expanduser()` should be replaced by `Path.expanduser()`
    "PTH118", # `os.path.join()` should be replaced by `Path` with `/` operator
    "PTH122", # `os.path.splitext()` should be replaced by `Path.suffix`, `Path.stem`, and `Path.parent`
]
"jwst/lib/engdb_lib.py" = [
    "B027", # XXX is an empty method in an abstract base class, but has no abstract decorator
]
"jwst/lib/suffix.py" = [
    "PTH118", # `os.path.join()` should be replaced by `Path` with `/` operator
]
"jwst/coron/**.py" = ["D", "N", "A", "ARG", "B", "C4", "ICN", "INP", "ISC", "LOG", "NPY", "PGH", "PTH", "S", "SLF", "SLOT", "T20", "TRY", "UP", "YTT", "E501"]
"jwst/cube_skymatch/**.py" = ["D", "N", "A", "ARG", "B", "C4", "ICN", "INP", "ISC", "LOG", "NPY", "PGH", "PTH", "S", "SLF", "SLOT", "T20", "TRY", "UP", "YTT", "E501"]
"jwst/dark_current/**.py" = ["D", "N", "A", "ARG", "B", "C4", "ICN", "INP", "ISC", "LOG", "NPY", "PGH", "PTH", "S", "SLF", "SLOT", "T20", "TRY", "UP", "YTT", "E501"]
"jwst/flatfield/**.py" = ["D", "N", "A", "ARG", "B", "C4", "ICN", "INP", "ISC", "LOG", "NPY", "PGH", "PTH", "S", "SLF", "SLOT", "T20", "TRY", "UP", "YTT", "E501"]
"jwst/fringe/**.py" = ["D", "N", "A", "ARG", "B", "C4", "ICN", "INP", "ISC", "LOG", "NPY", "PGH", "PTH", "S", "SLF", "SLOT", "T20", "TRY", "UP", "YTT", "E501"]
"jwst/ipc/**.py" = ["D", "N", "A", "ARG", "B", "C4", "ICN", "INP", "ISC", "LOG", "NPY", "PGH", "PTH", "S", "SLF", "SLOT", "T20", "TRY", "UP", "YTT", "E501"]
"jwst/mrs_imatch/**.py" = ["D", "N", "A", "ARG", "B", "C4", "ICN", "INP", "ISC", "LOG", "NPY", "PGH", "PTH", "S", "SLF", "SLOT", "T20", "TRY", "UP", "YTT", "E501"]
"jwst/persistence/**.py" = ["D", "N", "A", "ARG", "B", "C4", "ICN", "INP", "ISC", "LOG", "NPY", "PGH", "PTH", "S", "SLF", "SLOT", "T20", "TRY", "UP", "YTT", "E501"]
"jwst/photom/**.py" = ["D", "N", "A", "ARG", "B", "C4", "ICN", "INP", "ISC", "LOG", "NPY", "PGH", "PTH", "S", "SLF", "SLOT", "T20", "TRY", "UP", "YTT", "E501"]
